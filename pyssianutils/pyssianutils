#!/bin/usr/env python3
import sys

from pyssianutils.utils import  (MAINS, create_parser, 
                                 add_parser_as_subparser, register_main)

# These imports are required, to populate the SUBPARSERS and the MAINS variables
import pyssianutils.initialize
import pyssianutils.input
import pyssianutils.print
import pyssianutils.toxyz
import pyssianutils.track

if __name__ == '__main__': 
    parser, subparsers = create_parser()

    modules = [
        #(pyssianutils.input, ''),
        (pyssianutils.print, 'print'),
        (pyssianutils.toxyz, 'toxyz'),
        (pyssianutils.track, 'track'),
    ]
    for module,modulename in modules: 
        add_parser_as_subparser(subparsers,
                                module.parser,modulename,
                                help=module.__doc__)
        register_main(module.main,modulename)
    
    args = parser.parse_args()

    if args.command is None: 
        parser.print_help(sys.stderr)
    else:
        kwargs = dict(args._get_kwargs())
        command = kwargs.pop('command')
        
        if kwargs:
            MAINS[command](**kwargs)
        else:
            MAINS[command]()
